# MRLE

R package for Mendelian Randomization analysis for latent exposures (MRLE). The method uses GWAS summary-level association statistics of the outcome and K>=3 observable traits/biomarkers on a set of SNPs (instrumental variables) that are associated with at least two of the traits at specified thresholds of significance. The method uses an underlying structural equation model to describe causal paths between the SNPs, the latent exposure, the traits co-regulated by the exposure, and the outcome. A series of estimating functions are then constructed by equating the second-order sample moments of the summary-level association statistics with the corresponding theoretical moments, based on which inference for the model parameters can be done via Generalized Method of Moments.


## Contents

## Installation

``` r
# install.packages("devtools")
devtools::install_github("Jin93/MRLE")
library(readr)
```

## An example - testing the causal effect of chronic inflammation on rheumatoid arthritis (RA)

### Step 1. data preparation

##### data sources:
    1. GWAS summary data for RA   
    Okada, Y., Wu, D., Trynka, G., Raj, T., Terao, C., Ikari, K., Kochi, Y., Ohmura, K., Suzuki, A., Yoshida, S. and Graham, R.R., 2014. Genetics of rheumatoid arthritis contributes to biology and drug discovery. Nature, 506(7488), pp.376-381.
    2. GWAS summary data for CRP   
    GWAS on 320041 unrelated UK Biobank individuals
    3. GWAS summary data for IL1, IL6, IL8, TNP-alpha and MCP-1  
    Ahola-Olli, A.V., Würtz, P., Havulinna, A.S., Aalto, K., Pitkänen, N., Lehtimäki, T., Kähönen, M., Lyytikäinen, L.P., Raitoharju, E., Seppälä, I. and Sarin, A.P., 2017. Genome-wide association study identifies 27 loci influencing concentrations of circulating cytokines and growth factors. The American Journal of Human Genetics, 100(1), pp.40-50.

All GWAS samples are of European ancestry.

``` r
library(MRLE)
traitvec = c('IL1','IL6','IL8','TNF','MCP1') # vector of K biomarkers
K = length(traitvec)
exposure = 'inflammation'
outcome = 'ra'
N.biomarker = c(3309,8189,3526,3454,8293) # GWAS sample size of the traits/biomarkers
names(N.biomarker) = traitvec
thetak.sign = rep(1,K) # directions of the causal effect of chronic inflammation on the inflammatory biomarkers
alpha0 = 5e-2
z0 = qnorm(p=alpha0/2,lower.tail=FALSE)
maf.thr = 0.01
alpha2 = 5e-4 # SNP significance level of the association with the rest of the biomarkers
z2 = qnorm(p=alpha2/2,lower.tail=FALSE)


```







### Step 2. estimate between-trait covariance matrix of the GWAS summary statistics
``` r
ldsc.out.path="/dcl01/chatterj/data/jin/ldsc.out/"
ldsc.path = "/dcl01/chatterj/data/jin/ldsc/"
python.path = "~/anaconda2/bin/python" # change to the path to your python software
ldscore.path = file.path(ldsc.path,"eur_w_ld_chr/") # default, does not need to be specified
mydir = '/dcl01/chatterj/data/jin/ldclump/'
refdir = '/dcl01/chatterj/data/diptavo/1KG/'
load('/dcl01/chatterj/data/zyu/MRLE/sumstats.RData')
covresults = covinfo_inflammation(sumstats, out.path=ldsc.out.path, ldsc.path, python.path, ldscore.path = file.path(ldsc.path,"eur_w_ld_chr/"), maf.thr, mergeallele = TRUE, data.prep = F, K, screening = F)
#coherit.mat: Genetic covariance matrix
#ldscint.mat: LD score regression intercept matrix.
cor.mat = covresults$ldscint.mat
```


####  Reference:
      Jin, J., Qi, G., Yu, Z. and Chatterjee, N., 2021. Mendelian Randomization Analysis Using Multiple Biomarkers of an Underlying Common Exposure. bioRxiv.  [https://doi.org/10.1101/2021.02.05.429979](https://doi.org/10.1101/2021.02.05.429979)
